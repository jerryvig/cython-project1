<!doctype html>
<html>
<head>
	<title>FastCGI testing</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<style type="text/css">
		body {
			width: 100%;
		}

		#data-table {
			display: block;
			width: 60%;
			margin:0 auto;
		}

		th, td {
			padding: 6px;
		}

		.text-cell {
			text-align: left;
		}

		.numeric-cell {
			text-align: right;
		}

		.remove-cell {
			text-align: center;
		}

		#ticker-input {
			display: block;
			margin: 0 auto;
		}
	</style>
</head>
<body>
	<table id="data-table">
		<thead>
			<tr>
				<th>Remove Row</th>
				<th>Ticker</th>
				<th>Title</th>
				<th>Change</th>
				<th>Record Count</th>
				<th>Self Correlation</th>
				<th>Sigma</th>
				<th>Sigma Change</th>
				<th>Top 10 Down</th>
				<th>Top 10 Up</th>
				<th>Avg Move Top 10 Down</th>
				<th>Avg Move Top 10 Up</th>
			</tr>
		</thead>
		<tbody id="data-table-body"></tbody>
		<tfoot>
			<tr>
				<td colspan="12">
					<input id="ticker-input" type="text" placeholder="Enter ticker symbol here"></input>
				</td>
			</tr>
		</tfoot>
	</table>
</body>
<script type="text/javascript">
	var rowIndex = 0;	

	function addDataRow(ticker, data) {
		var nextDataRow = `<tr id=row-${rowIndex}>\
				<td class="remove-cell><div id="close-row-${rowIndex}">&times;</div></td>\
				<td class="text-cell">${data.resp_ticker}</td>\
				<td class="text-cell">${data.title}</td>\
				<td class="numeric-cell">${data.change}</td>\
				<td class="numeric-cell">${data.record_count}</td>\
				<td class="numeric-cell">${data.self_correlation}</td>\
				<td class="numeric-cell">${data.sigma}</td>\
				<td class="numeric-cell">${data.sigma_change}</td>\
				<td class="numeric-cell">${data.sign_diff_pct_10_down}</td>\
				<td class="numeric-cell">${data.sign_diff_pct_10_up}</td>\
				<td class="numeric-cell">${data.avg_move_10_down}</td>\
				<td class="numeric-cell">${data.avg_move_10_up}</td>\
			</tr>`;
		$('#data-table-body').append( nextDataRow );

		var closeId = `close-row-${rowIndex}`;
		$('#' + closeId).click(function() {
			alert('you clicked the close icon cell with id = ' + closeId);
		});
		console.log(`the event listener for ${closeId} should be added now`);
		rowIndex++;
	}

	$('#ticker-input').change(function(evt) {
		var ticker = $('#ticker-input').val();
		var url = `/compute_statistics/${ticker}`;

		$.get(url, function(data) {
			addDataRow(ticker, data);

			$('#ticker-input').val(''); 
		});
	});
</script>
</html>