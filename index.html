<!doctype html>
<html>
<head>
	<title>FastCGI testing</title>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
	<style type="text/css">
		body {
			width: 100%;
		}

		#data-table {
			display: block;
			width: 60%;
			margin:0 auto;
		}

		th, td {
			padding: 6px;
		}

		th:hover {
			background-color: #ADDFFF;
		}

		.text-cell {
			text-align: left;
		}

		.numeric-cell {
			text-align: right;
		}

		.remove-cell {
			text-align: center;
			font-weight: bold;
		}

		#ticker-input {
			display: block;
			margin: 0 auto;
		}
	</style>
</head>
<body>
	<table id="data-table">
		<thead>
			<tr>
				<th>Remove Row</th>
				<th>Ticker</th>
				<th>Title</th>
				<th>Change</th>
				<th>Record Count</th>
				<th>Self Correlation</th>
				<th>Sigma</th>
				<th>Sigma Change</th>
				<th>Top 10 Down</th>
				<th>Top 10 Up</th>
				<th>Avg Move Top 10 Down</th>
				<th>Avg Move Top 10 Up</th>
			</tr>
		</thead>
		<tbody id="data-table-body"></tbody>
		<tfoot>
			<tr>
				<td colspan="12">
					<input id="ticker-input" type="text" placeholder="Enter ticker symbol here"></input>
				</td>
			</tr>
		</tfoot>
	</table>
</body>
<script type="text/javascript">
	let rowIndex = 0;	

	const addDataRow = (ticker, data) => {
		const nextDataRow = `<tr id="row-${rowIndex}">\
				<td class="remove-cell" id="close-row-${rowIndex}">&times;</td>\
				<td class="text-cell">${data.resp_ticker}</td>\
				<td class="text-cell">${data.title}</td>\
				<td class="numeric-cell">${data.change}</td>\
				<td class="numeric-cell">${data.record_count}</td>\
				<td class="numeric-cell">${data.self_correlation}</td>\
				<td class="numeric-cell">${data.sigma}</td>\
				<td class="numeric-cell">${data.sigma_change}</td>\
				<td class="numeric-cell">${data.sign_diff_pct_10_down}</td>\
				<td class="numeric-cell">${data.sign_diff_pct_10_up}</td>\
				<td class="numeric-cell">${data.avg_move_10_down}</td>\
				<td class="numeric-cell">${data.avg_move_10_up}</td>\
			</tr>`;
		$('#data-table-body').append( nextDataRow );

		const closeId = `close-row-${rowIndex}`;
		$('#' + closeId).click(() => {
			$('#' + closeId).parent().remove();
		});
		rowIndex++;
	};

	$('#ticker-input').change((evt) => {
		const ticker = $('#ticker-input').val();
		const url = `/compute_statistics/${ticker}`;
		fetch(url).then(response => response.json()).then((data) => {
			addDataRow(ticker, data);
			$('#ticker-input').val('');
		});
	});
</script>
</html>